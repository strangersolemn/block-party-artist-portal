<!DOCTYPE html>
<html>
<head>
    <title>Simple Mask Test</title>
    <style>
        body { background: #1a1a2e; color: white; font-family: Arial; padding: 20px; }
        .container { display: flex; gap: 20px; }
        .box { border: 2px solid #ef4d99; }
        canvas { display: block; }
        button { background: #2e5130; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>Simple Test: Draw on right, see result on left</h2>
    
    <div class="container">
        <div>
            <h3>Result (500x500)</h3>
            <canvas id="result" width="500" height="500" class="box"></canvas>
            <br>
            <button onclick="compose()">COMPOSE</button>
        </div>
        
        <div>
            <h3>Draw here (500x500)</h3>
            <canvas id="drawing" width="500" height="500" class="box" style="cursor:crosshair"></canvas>
            <br>
            <button onclick="clearDrawing()">CLEAR</button>
        </div>
    </div>
    
    <script>
        const resultCanvas = document.getElementById('result');
        const resultCtx = resultCanvas.getContext('2d');
        const drawingCanvas = document.getElementById('drawing');
        const drawingCtx = drawingCanvas.getContext('2d');
        
        // Drawing state
        let isDrawing = false;
        
        // Load images
        const frogBody = new Image();
        const catFull = new Image();
        const catOutline = new Image();
        const maskImg = new Image();
        const maskOutline = new Image();
        
        frogBody.src = 'Body_sprites/1body-sprite.avif';
        catFull.src = 'cat-full.png';
        catOutline.src = 'cat-outline-positioned.png';
        maskImg.src = 'Centre_mask_mask.png';
        maskOutline.src = 'Centre_mask_outline.png';
        
        // Show mask outline on drawing canvas
        maskOutline.onload = function() {
            drawingCtx.drawImage(maskOutline, 0, 0, 500, 500);
        };
        
        // YOUR EXACT VALUES from position tool
        const MASK_X = -63;
        const MASK_Y = 318;
        const MASK_SCALE = 0.26;
        const MASK_ROTATION = 30;
        
        function compose() {
            // Clear result
            resultCtx.fillStyle = '#0a0a1b';
            resultCtx.fillRect(0, 0, 500, 500);
            
            // Draw frog body
            resultCtx.drawImage(frogBody, 0, 0, 500, 500, 0, 0, 500, 500);
            
            // Draw cat (behind mask)
            resultCtx.drawImage(catFull, 0, 0, 500, 500);
            
            // Now place the user's drawing
            // Scale: mask is 500x500 on drawing canvas, needs to be 500 * 0.26 = 130px
            const size = 500 * MASK_SCALE;
            
            resultCtx.save();
            
            // Move to position + center of scaled image
            resultCtx.translate(MASK_X + size/2, MASK_Y + size/2);
            // Rotate
            resultCtx.rotate(MASK_ROTATION * Math.PI / 180);
            // Draw centered
            resultCtx.drawImage(drawingCanvas, -size/2, -size/2, size, size);
            
            resultCtx.restore();
            
            // Draw cat outline on top
            resultCtx.drawImage(catOutline, 0, 0, 500, 500);
        }
        
        function clearDrawing() {
            drawingCtx.clearRect(0, 0, 500, 500);
            drawingCtx.drawImage(maskOutline, 0, 0, 500, 500);
        }
        
        // Simple drawing
        drawingCanvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
        });
        
        drawingCanvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            const rect = drawingCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            drawingCtx.fillStyle = 'red';
            drawingCtx.beginPath();
            drawingCtx.arc(x, y, 10, 0, Math.PI * 2);
            drawingCtx.fill();
        });
        
        drawingCanvas.addEventListener('mouseup', () => isDrawing = false);
        drawingCanvas.addEventListener('mouseleave', () => isDrawing = false);
    </script>
</body>
</html>
